<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Guide Debian 7 (partie 2/8) : sÃ©curiser l&amp;#8217;accÃ¨s SSH</title>
    <meta name="description" content="Cet article fait partie dâ€™une sÃ©rie de billets portant sur la mise en place dâ€™un serveur sous Debian Wheezy (voir le sommaire).">

    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="canonical" href="http://elliptips.info/guide-debian-7-securiser-lacces-ssh/">
    <link rel="alternate" type="application/rss+xml" title="Elliptips" href="/feed.xml">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600" rel="stylesheet">
    <link href="https://file.myfontastic.com/A2MgA9Cd47cENMsNJcc2Gk/icons.css" rel="stylesheet">
    
    
</head>


  <body>

    <header class="header" role="banner">
    <div class="container">
        <a class="logo" href="/">Elliptips</a>

        <nav class="nav">
            <a href="">A propos</a>
            <a href="https://twitter.com/robin_parisi" target="_blank">Twitter</a>
            <a href="https://github.com/robinparisi" target="_blank">Github</a>
        </nav>
    </div>
</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

    <header class="post-header">
        <div class="post-header__wrapper container">
            <h1 class="post-title" itemprop="name headline">Guide Debian 7 (partie 2/8) : sÃ©curiser l&amp;#8217;accÃ¨s SSH</h1>
            <div class="post-context">
                <div><i class="post-metaIcon icon-calendar"></i><span class="post-metaItem"><time datetime="2013-06-20T13:00:57+02:00" itemprop="datePublished">publiÃ© le 20/06/2013</time></span></div>
                <div><i class="post-metaIcon icon-clock"></i><span class="post-metaItem">Temps de lecture : 

5 mins

</span></div>
                <div><i class="post-metaIcon icon-pencil"></i><span class="post-metaItem"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Robin</span></span></span></div>
                <div class="post-shareBox">
                    Partager :
                    <a href="#" title="Partager sur Twitter"><i class="icon-twitter color-twitter"></i></a>
                    <a href="#" title="Partager sur Facebook"><i class="icon-facebook color-facebook"></i></a>
                    <a href="#" title="Partager sur Google+"><i class="icon-google-plus color-google"></i></a>
                    <a href="#" title="Partager par e-mail+"><i class="icon-envelope color-mail"></i></a>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="post-content" itemprop="articleBody">
            <p>Cet article fait partie dâ€™une sÃ©rie de billets portant sur la mise en place dâ€™un serveur sous Debian Wheezy (<a href="http://elliptips.info/guide-sur-linstallation-dun-serveur-sous-debian-7-wheezy/" title="guide debian wheezy sommaire">voir le sommaire</a>).</p>

<h2 id="introduction">Introduction</h2>

<p>De la mÃªme faÃ§on que vous ne laissez pas la porte ouverte en sortant de chez vous, la porte dâ€™entrÃ©e de votre serveur, câ€™est-Ã -dire lâ€™accÃ¨s SSH, requiert un minimum de sÃ©curisation.</p>

<h2 id="modifier-le-mot-de-passe-root"><strong>Modifier le mot de passe root</strong></h2>

<p>En gÃ©nÃ©ral, aprÃ¨s la commande dâ€™un serveur dÃ©diÃ© ou virtuel, votre prestataire vous transmettra les informations de connexion par mail, en y joignant le mot de passe du compte root. Il est important de <strong>changer celui-ci immÃ©diatement dÃ¨s votre premiÃ¨re connexion</strong>.</p>

<p>Pour cela, lancez la commande suivante en rootÂ :</p>

<pre class="lang:sh decode:true">passwd</pre>

<p>Je ne vous ferai pas lâ€™affront de vous expliquer pourquoi un mot de passe suffisamment complexe pour ne pas Ãªtre trouvÃ© pas une attaque de type bruteforce ou dictionnaire est trÃ¨s largement souhaitable ğŸ™‚</p>

<h2 id="ajout-dun-nouvel-utilisateur"><strong>Ajout dâ€™un nouvel utilisateur</strong></h2>

<p>Pour la suite, et pour des raisons de sÃ©curitÃ© Ã©videntes, <strong>nous nâ€™utiliserons pas le compte root pour les connexions Ã  distance</strong>. Câ€™est pourquoi nous allons crÃ©er un groupe contenant des utilisateurs qui seront autorisÃ©s Ã  se connecter via SSH.</p>

<pre class="lang:sh decode:true">groupadd sshusers</pre>

<p>On crÃ©Ã© ensuite un nouvel utilisateur puis on lâ€™ajoute au groupe qui sera autorisÃ© Ã  se connecter via SSH.</p>

<pre class="lang:sh decode:true">useradd -m homer
passwd homer
usermod -a -G sshusers homer</pre>

<h2 id="configuration-de-ssh"><strong>Configuration de ssh</strong></h2>

<pre class="lang:sh decode:true">vim /etc/ssh/sshd_config</pre>

<p>On commence par changer le port par dÃ©faut :</p>

<pre class="lang:default decode:true">Port 2222</pre>

<p>NoteÂ : Vous pouvez utiliser nâ€™importe quel port, pour peu que celui-ci ne soit pas rÃ©servÃ© par un autre service. Avoir un port non standard vous permettra dâ€™Ã©viter une partie des attaques automatisÃ©es que lâ€™on rencontre chez certains prestataires . Et comme jâ€™entends dÃ©jÃ  les experts hurler, je prÃ©cise que oui, lâ€™obscurantisme nâ€™est en aucun cas un gage de sÃ©curitÃ©. Toutefois, je peux vous assurer quâ€™un simple changement de port sur uneÂ <em>dedibox</em>Â permet de souffler un peu au niveau des tentatives de bruteforce SSH (les IP des machines sont connues et les scripts kiddies sâ€™en donnent Ã  coeur joie). Pour conclure, nâ€™oubliez jamais quâ€™un attaquant qui se focalisera sur votre serveur nâ€™aura aucun mal Ã  dÃ©terminer sur quel port tourne le daemon SSH.</p>

<p>Le compte root nâ€™est pas autorisÃ© Ã  se connecter directement depuis SSH :</p>

<pre>PermitRootLogin no</pre>

<p>Seul les utilisateurs appartenant au groupe sshusers sont autorisÃ©s Ã  se connecter (il faut ajouter cette ligne) :</p>

<pre>AllowGroups sshusers</pre>

<p>on vÃ©rifie que la version 2 du protocole est utilisÃ©e :</p>

<pre class="lang:sh decode:true">Protocol 2</pre>

<p>On redÃ©marre le daemon SSH :</p>

<pre class="lang:sh decode:true">/etc/init.d/ssh restart</pre>

<p><span style="color: #ff0000;">Ã€ ce stade, ne surtout pas fermer lâ€™ancienne connexion, au risque de ne plus pouvoir se reconnecter par la suite. Ce que je vous conseille, câ€™est dâ€™ouvrir un nouvel onglet dans votre terminal et de tester la connexion avec le port et lâ€™utilisateur adÃ©quat.</span></p>

<h2 id="authentification-par-un-systme-de-cl-publiquecl-prive"><strong>Authentification par un systÃ¨me de clÃ© publique/clÃ© privÃ©e</strong></h2>

<p>Lâ€™authentification par <strong>clÃ© publique/privÃ©e</strong> se rÃ©vÃ¨le pratique dans le cas oÃ¹ vous souhaitez ne pas avoir Ã  taper le mot de passe Ã  chaque connexion.</p>

<p>Cette technique permet de renforcer la sÃ©curitÃ©, car elle demande Ã  lâ€™utilisateur dâ€™Ãªtre en possession de deux informations pour se connecter au serveur (<strong>une clÃ© privÃ©e et le mot de passe de cette clÃ©</strong>).</p>

<p>Je ne dÃ©taillerai pas ici le fonctionnement du protocole, sachez juste que nous allons avoir besoin de deux choses :</p>

<ul>
  <li>une clÃ© privÃ©e, que lâ€™on gardera prÃ©cieusement sur notre ordinateur, dans le dossier .ssh de notre rÃ©pertoire personnel</li>
  <li>une clÃ© publique, que lâ€™on enverra dans le dossier .ssh de lâ€™utilisateur sur le serveur</li>
</ul>

<p>Pour gÃ©nÃ©rer tout Ã§a, rien de plus simple, il suffit de lancer la commande suivante sur <strong>votre ordinateur</strong> .</p>

<pre class="lang:sh decode:true">ssh-keygen -t rsa</pre>

<p>RÃ©pondre aux questions :</p>

<pre class="lang:default decode:true">Enter file in which to save the key (/Users/votre_user/.ssh/id_rsa): faire entrÃ©e

Enter passphrase (empty for no passphrase): choisir un mot de passe qui protÃ¨gera la clÃ©</pre>

<p>La phrase de passe (ou passphrase) sert en fait Ã  dÃ©crypter votre clÃ© privÃ©e. Il est possible de ne pas en mettre, mais dans ce cas, une personne qui mettrait la main sur votre clÃ© privÃ©e serait tout Ã  fait apte Ã  se connecter au serveur. Bref, il serait idiot de se priver dâ€™une protection supplÃ©mentaire, donc choisissez un mot de passe avec soin.</p>

<p>Il faut maintenant copier la clÃ© publique dans le rÃ©pertoire .ssh de votre utilisateur (celui avec lequel vous vous connectez sur le serveur) :</p>

<p>Pour cela, lancer la commande suivante depuis votre ordinateur :</p>

<pre class="lang:sh decode:true">ssh &lt;user&gt;@&lt;ip_du_serveur&gt; -p &lt;port&gt; "echo $(cat ~/.ssh/id_rsa.pub) &gt;&gt; .ssh/authorized_keys"</pre>

<p>Note : il se peut que le rÃ©pertoire .ssh nâ€™existe pas dans le home de votre utilisateur sur le serveur. Il suffit de se connecter sur celui-ci et de le crÃ©er :</p>

<pre class="lang:sh decode:true">cd
mkdir .ssh
touch .ssh/authorized_keys</pre>

<p>Si tout sâ€™est bien passÃ©, vous devriez Ãªtre en mesure de vous connecter au serveur en utilisant le systÃ¨me de clÃ©. Ã€ la premiÃ¨re connexion, le mot de passe servant Ã  dÃ©crypter la clÃ© privÃ©e vous sera demandÃ©. Sur OSX, le systÃ¨me vous proposera de lâ€™enregistrer dans le trousseau dâ€™accÃ¨s. Sous un systÃ¨me Linux, il est possible quâ€™il en fasse de mÃªme (sinon, utilisez ssh-agent pour ne pas avoir Ã  retaper ce mot de passe).</p>

<p>Si vous le souhaitez, vous pouvez aussi utiliser uniquement le systÃ¨me de clÃ©s pour vous connecter au serveur en passant le paramÃ¨tre PasswordAuthentication sur no dans le fichier /etc/ssh/sshd_config. De ce fait, seule une personne possÃ©dant la clÃ© privÃ©e et son mot de passe sera apte Ã  se connecter. Cependant, si jamais vous perdez cette clÃ©, vous serez incapable de vous connecter par la suite. Faites donc attention si vous optez pour cette solution</p>

<p>Rendez-vous demain pour la troisiÃ¨me partie de ce guide qui portera sur lâ€™envoi de mail depuis votre serveur ğŸ™‚</p>

        </div>
    </div>

    
</article>

      </div>
    </main>

    <div class="container">
    <footer class="footer txtcenter">
        Sauf mention spÃ©ciale, le contenu de ce site est distribuÃ© sous licence <a href="#">CC BY-NC-SA 3.0</a>
    </footer>
</div>


  </body>

</html>
